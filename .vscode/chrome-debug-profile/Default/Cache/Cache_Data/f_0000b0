import { useApolloClient } from "/@fs/D:/twenty-table-o/node_modules/.vite/packages/twenty-front/deps/@apollo_client.js?v=226f7286";
import __vite__cjsImport1__sniptt_guards from "/@fs/D:/twenty-table-o/node_modules/.vite/packages/twenty-front/deps/@sniptt_guards.js?v=226f7286"; const isNonEmptyString = __vite__cjsImport1__sniptt_guards["isNonEmptyString"]; const isObject = __vite__cjsImport1__sniptt_guards["isObject"];
import __vite__cjsImport2_qs from "/@fs/D:/twenty-table-o/node_modules/.vite/packages/twenty-front/deps/qs.js?v=226f7286"; const qs = __vite__cjsImport2_qs.__esModule ? __vite__cjsImport2_qs.default : __vite__cjsImport2_qs;
import __vite__cjsImport3_react from "/@fs/D:/twenty-table-o/node_modules/.vite/packages/twenty-front/deps/react.js?v=226f7286"; const useMemo = __vite__cjsImport3_react["useMemo"];
import { useParams, useSearchParams } from "/@fs/D:/twenty-table-o/node_modules/.vite/packages/twenty-front/deps/react-router-dom.js?v=226f7286";
import { useRecoilCallback, useRecoilValue } from "/@fs/D:/twenty-table-o/node_modules/.vite/packages/twenty-front/deps/recoil.js?v=226f7286";
import z from "/@fs/D:/twenty-table-o/node_modules/.vite/packages/twenty-front/deps/zod.js?v=226f7286";
import { useObjectMetadataItem } from "/src/modules/object-metadata/hooks/useObjectMetadataItem.ts";
import { useObjectNameSingularFromPlural } from "/src/modules/object-metadata/hooks/useObjectNameSingularFromPlural.ts";
import { objectMetadataItemFamilySelector } from "/src/modules/object-metadata/states/objectMetadataItemFamilySelector.ts";
import { objectMetadataItemsState } from "/src/modules/object-metadata/states/objectMetadataItemsState.ts";
import { getObjectRecordIdentifier } from "/src/modules/object-metadata/utils/getObjectRecordIdentifier.ts";
import { generateFindManyRecordsQuery } from "/src/modules/object-record/utils/generateFindManyRecordsQuery.ts";
import { ViewFilterOperand } from "/src/modules/views/types/ViewFilterOperand.ts";
import { relationFilterValueSchemaObject } from "/src/modules/views/view-filter-value/validation-schemas/jsonRelationFilterValueSchema.ts";
import { isDefined } from "/@fs/D:/twenty-table-o/packages/twenty-shared/utils/dist/twenty-shared-utils.esm.js";
const filterQueryParamsSchema = z.object({
    viewId: z.string().optional(),
    filter: z.record(z.record(z.nativeEnum(ViewFilterOperand), z.string().or(z.array(z.string())).or(relationFilterValueSchemaObject))).optional()
});
export const useViewFromQueryParams = ()=>{
    const apolloClient = useApolloClient();
    const [searchParams] = useSearchParams();
    const { objectNamePlural = '' } = useParams();
    const { objectNameSingular } = useObjectNameSingularFromPlural({
        objectNamePlural
    });
    const { objectMetadataItem } = useObjectMetadataItem({
        objectNameSingular
    });
    const objectMetadataItems = useRecoilValue(objectMetadataItemsState);
    const queryParamsValidation = filterQueryParamsSchema.safeParse(qs.parse(searchParams.toString()));
    const filterQueryParams = useMemo(()=>queryParamsValidation.success ? queryParamsValidation.data.filter : {}, [
        queryParamsValidation
    ]);
    const viewIdQueryParam = useMemo(()=>queryParamsValidation.success ? queryParamsValidation.data.viewId : undefined, [
        queryParamsValidation
    ]);
    const hasFiltersQueryParams = isDefined(filterQueryParams) && Object.entries(filterQueryParams).length > 0;
    const getFiltersFromQueryParams = useRecoilCallback(({ snapshot })=>async ()=>{
            if (!hasFiltersQueryParams) return [];
            return (await Promise.all(Object.entries(filterQueryParams).map(async ([fieldName, filterFromURL])=>{
                const [filterOperandFromURL, filterValueFromURL] = Object.entries(filterFromURL)[0];
                const fieldMetadataItem = objectMetadataItem.fields.find((field)=>field.name === fieldName);
                if (!fieldMetadataItem) return null;
                const relationObjectMetadataNameSingular = fieldMetadataItem.relationDefinition?.targetObjectMetadata?.nameSingular;
                const relationObjectMetadataNamePlural = fieldMetadataItem.relationDefinition?.targetObjectMetadata?.namePlural;
                const relationObjectMetadataItem = relationObjectMetadataNameSingular ? snapshot.getLoadable(objectMetadataItemFamilySelector({
                    objectName: relationObjectMetadataNameSingular,
                    objectNameType: 'singular'
                })).getValue() : null;
                const satisfiesRelationFilterSchema = relationFilterValueSchemaObject.safeParse(filterValueFromURL)?.success;
                const relationRecordNames = [];
                if (isNonEmptyString(relationObjectMetadataNamePlural) && isDefined(relationObjectMetadataItem) && (Array.isArray(filterValueFromURL) || satisfiesRelationFilterSchema)) {
                    const queryResult = await apolloClient.query({
                        query: generateFindManyRecordsQuery({
                            objectMetadataItem: relationObjectMetadataItem,
                            objectMetadataItems
                        }),
                        variables: {
                            filter: {
                                id: {
                                    in: satisfiesRelationFilterSchema ? filterValueFromURL?.selectedRecordIds : filterValueFromURL
                                }
                            }
                        }
                    });
                    const relationRecordNamesFromQuery = queryResult.data?.[relationObjectMetadataNamePlural]?.edges.map(({ node: record })=>getObjectRecordIdentifier({
                            objectMetadataItem: relationObjectMetadataItem,
                            record
                        }).name);
                    relationRecordNames.push(...relationRecordNamesFromQuery);
                }
                const filterValueAsString = Array.isArray(filterValueFromURL) || isObject(filterValueFromURL) ? JSON.stringify(filterValueFromURL) : filterValueFromURL;
                return {
                    __typename: 'ViewFilter',
                    id: `tmp-${[
                        fieldName,
                        filterOperandFromURL,
                        filterValueFromURL
                    ].join('-')}`,
                    fieldMetadataId: fieldMetadataItem.id,
                    operand: filterOperandFromURL,
                    value: filterValueAsString,
                    displayValue: relationRecordNames?.join(', ') ?? filterValueAsString,
                    persistAction: 'NONE'
                };
            }))).filter(isDefined);
        }, [
        apolloClient,
        filterQueryParams,
        hasFiltersQueryParams,
        objectMetadataItem.fields,
        objectMetadataItems
    ]);
    return {
        viewIdQueryParam,
        hasFiltersQueryParams,
        getFiltersFromQueryParams
    };
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZVZpZXdGcm9tUXVlcnlQYXJhbXMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdXNlQXBvbGxvQ2xpZW50IH0gZnJvbSAnQGFwb2xsby9jbGllbnQnO1xuaW1wb3J0IHsgaXNOb25FbXB0eVN0cmluZywgaXNPYmplY3QgfSBmcm9tICdAc25pcHR0L2d1YXJkcyc7XG5pbXBvcnQgcXMgZnJvbSAncXMnO1xuaW1wb3J0IHsgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHVzZVBhcmFtcywgdXNlU2VhcmNoUGFyYW1zIH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSc7XG5pbXBvcnQgeyB1c2VSZWNvaWxDYWxsYmFjaywgdXNlUmVjb2lsVmFsdWUgfSBmcm9tICdyZWNvaWwnO1xuaW1wb3J0IHogZnJvbSAnem9kJztcblxuaW1wb3J0IHsgdXNlT2JqZWN0TWV0YWRhdGFJdGVtIH0gZnJvbSAnQC9vYmplY3QtbWV0YWRhdGEvaG9va3MvdXNlT2JqZWN0TWV0YWRhdGFJdGVtJztcbmltcG9ydCB7IHVzZU9iamVjdE5hbWVTaW5ndWxhckZyb21QbHVyYWwgfSBmcm9tICdAL29iamVjdC1tZXRhZGF0YS9ob29rcy91c2VPYmplY3ROYW1lU2luZ3VsYXJGcm9tUGx1cmFsJztcbmltcG9ydCB7IG9iamVjdE1ldGFkYXRhSXRlbUZhbWlseVNlbGVjdG9yIH0gZnJvbSAnQC9vYmplY3QtbWV0YWRhdGEvc3RhdGVzL29iamVjdE1ldGFkYXRhSXRlbUZhbWlseVNlbGVjdG9yJztcbmltcG9ydCB7IG9iamVjdE1ldGFkYXRhSXRlbXNTdGF0ZSB9IGZyb20gJ0Avb2JqZWN0LW1ldGFkYXRhL3N0YXRlcy9vYmplY3RNZXRhZGF0YUl0ZW1zU3RhdGUnO1xuaW1wb3J0IHsgZ2V0T2JqZWN0UmVjb3JkSWRlbnRpZmllciB9IGZyb20gJ0Avb2JqZWN0LW1ldGFkYXRhL3V0aWxzL2dldE9iamVjdFJlY29yZElkZW50aWZpZXInO1xuaW1wb3J0IHsgT2JqZWN0UmVjb3JkIH0gZnJvbSAnQC9vYmplY3QtcmVjb3JkL3R5cGVzL09iamVjdFJlY29yZCc7XG5pbXBvcnQgeyBnZW5lcmF0ZUZpbmRNYW55UmVjb3Jkc1F1ZXJ5IH0gZnJvbSAnQC9vYmplY3QtcmVjb3JkL3V0aWxzL2dlbmVyYXRlRmluZE1hbnlSZWNvcmRzUXVlcnknO1xuaW1wb3J0IHsgVmlld0ZpbHRlciB9IGZyb20gJ0Avdmlld3MvdHlwZXMvVmlld0ZpbHRlcic7XG5pbXBvcnQgeyBWaWV3RmlsdGVyT3BlcmFuZCB9IGZyb20gJ0Avdmlld3MvdHlwZXMvVmlld0ZpbHRlck9wZXJhbmQnO1xuaW1wb3J0IHsgcmVsYXRpb25GaWx0ZXJWYWx1ZVNjaGVtYU9iamVjdCB9IGZyb20gJ0Avdmlld3Mvdmlldy1maWx0ZXItdmFsdWUvdmFsaWRhdGlvbi1zY2hlbWFzL2pzb25SZWxhdGlvbkZpbHRlclZhbHVlU2NoZW1hJztcbmltcG9ydCB7IGlzRGVmaW5lZCB9IGZyb20gJ3R3ZW50eS1zaGFyZWQvdXRpbHMnO1xuXG5jb25zdCBmaWx0ZXJRdWVyeVBhcmFtc1NjaGVtYSA9IHoub2JqZWN0KHtcbiAgdmlld0lkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGZpbHRlcjogelxuICAgIC5yZWNvcmQoXG4gICAgICB6LnJlY29yZChcbiAgICAgICAgei5uYXRpdmVFbnVtKFZpZXdGaWx0ZXJPcGVyYW5kKSxcbiAgICAgICAgei5zdHJpbmcoKS5vcih6LmFycmF5KHouc3RyaW5nKCkpKS5vcihyZWxhdGlvbkZpbHRlclZhbHVlU2NoZW1hT2JqZWN0KSxcbiAgICAgICksXG4gICAgKVxuICAgIC5vcHRpb25hbCgpLFxufSk7XG5cbmV4cG9ydCB0eXBlIEZpbHRlclF1ZXJ5UGFyYW1zID0gei5pbmZlcjx0eXBlb2YgZmlsdGVyUXVlcnlQYXJhbXNTY2hlbWE+O1xuXG5leHBvcnQgY29uc3QgdXNlVmlld0Zyb21RdWVyeVBhcmFtcyA9ICgpID0+IHtcbiAgY29uc3QgYXBvbGxvQ2xpZW50ID0gdXNlQXBvbGxvQ2xpZW50KCk7XG4gIGNvbnN0IFtzZWFyY2hQYXJhbXNdID0gdXNlU2VhcmNoUGFyYW1zKCk7XG4gIGNvbnN0IHsgb2JqZWN0TmFtZVBsdXJhbCA9ICcnIH0gPSB1c2VQYXJhbXMoKTtcbiAgY29uc3QgeyBvYmplY3ROYW1lU2luZ3VsYXIgfSA9IHVzZU9iamVjdE5hbWVTaW5ndWxhckZyb21QbHVyYWwoe1xuICAgIG9iamVjdE5hbWVQbHVyYWwsXG4gIH0pO1xuICBjb25zdCB7IG9iamVjdE1ldGFkYXRhSXRlbSB9ID0gdXNlT2JqZWN0TWV0YWRhdGFJdGVtKHtcbiAgICBvYmplY3ROYW1lU2luZ3VsYXIsXG4gIH0pO1xuXG4gIGNvbnN0IG9iamVjdE1ldGFkYXRhSXRlbXMgPSB1c2VSZWNvaWxWYWx1ZShvYmplY3RNZXRhZGF0YUl0ZW1zU3RhdGUpO1xuXG4gIGNvbnN0IHF1ZXJ5UGFyYW1zVmFsaWRhdGlvbiA9IGZpbHRlclF1ZXJ5UGFyYW1zU2NoZW1hLnNhZmVQYXJzZShcbiAgICBxcy5wYXJzZShzZWFyY2hQYXJhbXMudG9TdHJpbmcoKSksXG4gICk7XG5cbiAgY29uc3QgZmlsdGVyUXVlcnlQYXJhbXMgPSB1c2VNZW1vKFxuICAgICgpID0+XG4gICAgICBxdWVyeVBhcmFtc1ZhbGlkYXRpb24uc3VjY2VzcyA/IHF1ZXJ5UGFyYW1zVmFsaWRhdGlvbi5kYXRhLmZpbHRlciA6IHt9LFxuICAgIFtxdWVyeVBhcmFtc1ZhbGlkYXRpb25dLFxuICApO1xuICBjb25zdCB2aWV3SWRRdWVyeVBhcmFtID0gdXNlTWVtbyhcbiAgICAoKSA9PlxuICAgICAgcXVlcnlQYXJhbXNWYWxpZGF0aW9uLnN1Y2Nlc3NcbiAgICAgICAgPyBxdWVyeVBhcmFtc1ZhbGlkYXRpb24uZGF0YS52aWV3SWRcbiAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgW3F1ZXJ5UGFyYW1zVmFsaWRhdGlvbl0sXG4gICk7XG5cbiAgY29uc3QgaGFzRmlsdGVyc1F1ZXJ5UGFyYW1zID1cbiAgICBpc0RlZmluZWQoZmlsdGVyUXVlcnlQYXJhbXMpICYmXG4gICAgT2JqZWN0LmVudHJpZXMoZmlsdGVyUXVlcnlQYXJhbXMpLmxlbmd0aCA+IDA7XG5cbiAgY29uc3QgZ2V0RmlsdGVyc0Zyb21RdWVyeVBhcmFtcyA9IHVzZVJlY29pbENhbGxiYWNrKFxuICAgICh7IHNuYXBzaG90IH0pID0+XG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIGlmICghaGFzRmlsdGVyc1F1ZXJ5UGFyYW1zKSByZXR1cm4gW107XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGZpbHRlclF1ZXJ5UGFyYW1zKS5tYXA8UHJvbWlzZTxWaWV3RmlsdGVyIHwgbnVsbD4+KFxuICAgICAgICAgICAgICBhc3luYyAoW2ZpZWxkTmFtZSwgZmlsdGVyRnJvbVVSTF0pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBbZmlsdGVyT3BlcmFuZEZyb21VUkwsIGZpbHRlclZhbHVlRnJvbVVSTF0gPVxuICAgICAgICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMoZmlsdGVyRnJvbVVSTClbMF07XG4gICAgICAgICAgICAgICAgY29uc3QgZmllbGRNZXRhZGF0YUl0ZW0gPSBvYmplY3RNZXRhZGF0YUl0ZW0uZmllbGRzLmZpbmQoXG4gICAgICAgICAgICAgICAgICAoZmllbGQpID0+IGZpZWxkLm5hbWUgPT09IGZpZWxkTmFtZSxcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFmaWVsZE1ldGFkYXRhSXRlbSkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgICAgICAgICBjb25zdCByZWxhdGlvbk9iamVjdE1ldGFkYXRhTmFtZVNpbmd1bGFyID1cbiAgICAgICAgICAgICAgICAgIGZpZWxkTWV0YWRhdGFJdGVtLnJlbGF0aW9uRGVmaW5pdGlvbj8udGFyZ2V0T2JqZWN0TWV0YWRhdGFcbiAgICAgICAgICAgICAgICAgICAgPy5uYW1lU2luZ3VsYXI7XG5cbiAgICAgICAgICAgICAgICBjb25zdCByZWxhdGlvbk9iamVjdE1ldGFkYXRhTmFtZVBsdXJhbCA9XG4gICAgICAgICAgICAgICAgICBmaWVsZE1ldGFkYXRhSXRlbS5yZWxhdGlvbkRlZmluaXRpb24/LnRhcmdldE9iamVjdE1ldGFkYXRhXG4gICAgICAgICAgICAgICAgICAgID8ubmFtZVBsdXJhbDtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHJlbGF0aW9uT2JqZWN0TWV0YWRhdGFJdGVtID1cbiAgICAgICAgICAgICAgICAgIHJlbGF0aW9uT2JqZWN0TWV0YWRhdGFOYW1lU2luZ3VsYXJcbiAgICAgICAgICAgICAgICAgICAgPyBzbmFwc2hvdFxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldExvYWRhYmxlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RNZXRhZGF0YUl0ZW1GYW1pbHlTZWxlY3Rvcih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0TmFtZTogcmVsYXRpb25PYmplY3RNZXRhZGF0YU5hbWVTaW5ndWxhcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3ROYW1lVHlwZTogJ3Npbmd1bGFyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAuZ2V0VmFsdWUoKVxuICAgICAgICAgICAgICAgICAgICA6IG51bGw7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzYXRpc2ZpZXNSZWxhdGlvbkZpbHRlclNjaGVtYSA9XG4gICAgICAgICAgICAgICAgICByZWxhdGlvbkZpbHRlclZhbHVlU2NoZW1hT2JqZWN0LnNhZmVQYXJzZShcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVmFsdWVGcm9tVVJMLFxuICAgICAgICAgICAgICAgICAgKT8uc3VjY2VzcztcblxuICAgICAgICAgICAgICAgIGNvbnN0IHJlbGF0aW9uUmVjb3JkTmFtZXMgPSBbXTtcblxuICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgIGlzTm9uRW1wdHlTdHJpbmcocmVsYXRpb25PYmplY3RNZXRhZGF0YU5hbWVQbHVyYWwpICYmXG4gICAgICAgICAgICAgICAgICBpc0RlZmluZWQocmVsYXRpb25PYmplY3RNZXRhZGF0YUl0ZW0pICYmXG4gICAgICAgICAgICAgICAgICAoQXJyYXkuaXNBcnJheShmaWx0ZXJWYWx1ZUZyb21VUkwpIHx8XG4gICAgICAgICAgICAgICAgICAgIHNhdGlzZmllc1JlbGF0aW9uRmlsdGVyU2NoZW1hKVxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgY29uc3QgcXVlcnlSZXN1bHQgPSBhd2FpdCBhcG9sbG9DbGllbnQucXVlcnk8XG4gICAgICAgICAgICAgICAgICAgIFJlY29yZDxzdHJpbmcsIHsgZWRnZXM6IHsgbm9kZTogT2JqZWN0UmVjb3JkIH1bXSB9PlxuICAgICAgICAgICAgICAgICAgPih7XG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBnZW5lcmF0ZUZpbmRNYW55UmVjb3Jkc1F1ZXJ5KHtcbiAgICAgICAgICAgICAgICAgICAgICBvYmplY3RNZXRhZGF0YUl0ZW06IHJlbGF0aW9uT2JqZWN0TWV0YWRhdGFJdGVtLFxuICAgICAgICAgICAgICAgICAgICAgIG9iamVjdE1ldGFkYXRhSXRlbXMsXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGluOiBzYXRpc2ZpZXNSZWxhdGlvbkZpbHRlclNjaGVtYVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJWYWx1ZUZyb21VUkwgYXMge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkUmVjb3JkSWRzOiBzdHJpbmdbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKT8uc2VsZWN0ZWRSZWNvcmRJZHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGZpbHRlclZhbHVlRnJvbVVSTCxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICBjb25zdCByZWxhdGlvblJlY29yZE5hbWVzRnJvbVF1ZXJ5ID0gcXVlcnlSZXN1bHQuZGF0YT8uW1xuICAgICAgICAgICAgICAgICAgICByZWxhdGlvbk9iamVjdE1ldGFkYXRhTmFtZVBsdXJhbFxuICAgICAgICAgICAgICAgICAgXT8uZWRnZXMubWFwKFxuICAgICAgICAgICAgICAgICAgICAoeyBub2RlOiByZWNvcmQgfSkgPT5cbiAgICAgICAgICAgICAgICAgICAgICBnZXRPYmplY3RSZWNvcmRJZGVudGlmaWVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdE1ldGFkYXRhSXRlbTogcmVsYXRpb25PYmplY3RNZXRhZGF0YUl0ZW0sXG4gICAgICAgICAgICAgICAgICAgICAgICByZWNvcmQsXG4gICAgICAgICAgICAgICAgICAgICAgfSkubmFtZSxcbiAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgIHJlbGF0aW9uUmVjb3JkTmFtZXMucHVzaCguLi5yZWxhdGlvblJlY29yZE5hbWVzRnJvbVF1ZXJ5KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBmaWx0ZXJWYWx1ZUFzU3RyaW5nID1cbiAgICAgICAgICAgICAgICAgIEFycmF5LmlzQXJyYXkoZmlsdGVyVmFsdWVGcm9tVVJMKSB8fFxuICAgICAgICAgICAgICAgICAgaXNPYmplY3QoZmlsdGVyVmFsdWVGcm9tVVJMKVxuICAgICAgICAgICAgICAgICAgICA/IEpTT04uc3RyaW5naWZ5KGZpbHRlclZhbHVlRnJvbVVSTClcbiAgICAgICAgICAgICAgICAgICAgOiBmaWx0ZXJWYWx1ZUZyb21VUkw7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgX190eXBlbmFtZTogJ1ZpZXdGaWx0ZXInLFxuICAgICAgICAgICAgICAgICAgaWQ6IGB0bXAtJHtbXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyT3BlcmFuZEZyb21VUkwsXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlclZhbHVlRnJvbVVSTCxcbiAgICAgICAgICAgICAgICAgIF0uam9pbignLScpfWAsXG4gICAgICAgICAgICAgICAgICBmaWVsZE1ldGFkYXRhSWQ6IGZpZWxkTWV0YWRhdGFJdGVtLmlkLFxuICAgICAgICAgICAgICAgICAgb3BlcmFuZDogZmlsdGVyT3BlcmFuZEZyb21VUkwgYXMgVmlld0ZpbHRlck9wZXJhbmQsXG4gICAgICAgICAgICAgICAgICB2YWx1ZTogZmlsdGVyVmFsdWVBc1N0cmluZyxcbiAgICAgICAgICAgICAgICAgIGRpc3BsYXlWYWx1ZTpcbiAgICAgICAgICAgICAgICAgICAgcmVsYXRpb25SZWNvcmROYW1lcz8uam9pbignLCAnKSA/PyBmaWx0ZXJWYWx1ZUFzU3RyaW5nLFxuICAgICAgICAgICAgICAgICAgcGVyc2lzdEFjdGlvbjogJ05PTkUnLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICApLFxuICAgICAgICAgIClcbiAgICAgICAgKS5maWx0ZXIoaXNEZWZpbmVkKTtcbiAgICAgIH0sXG4gICAgW1xuICAgICAgYXBvbGxvQ2xpZW50LFxuICAgICAgZmlsdGVyUXVlcnlQYXJhbXMsXG4gICAgICBoYXNGaWx0ZXJzUXVlcnlQYXJhbXMsXG4gICAgICBvYmplY3RNZXRhZGF0YUl0ZW0uZmllbGRzLFxuICAgICAgb2JqZWN0TWV0YWRhdGFJdGVtcyxcbiAgICBdLFxuICApO1xuXG4gIHJldHVybiB7XG4gICAgdmlld0lkUXVlcnlQYXJhbSxcbiAgICBoYXNGaWx0ZXJzUXVlcnlQYXJhbXMsXG4gICAgZ2V0RmlsdGVyc0Zyb21RdWVyeVBhcmFtcyxcbiAgfTtcbn07XG4iXSwibmFtZXMiOlsidXNlQXBvbGxvQ2xpZW50IiwiaXNOb25FbXB0eVN0cmluZyIsImlzT2JqZWN0IiwicXMiLCJ1c2VNZW1vIiwidXNlUGFyYW1zIiwidXNlU2VhcmNoUGFyYW1zIiwidXNlUmVjb2lsQ2FsbGJhY2siLCJ1c2VSZWNvaWxWYWx1ZSIsInoiLCJ1c2VPYmplY3RNZXRhZGF0YUl0ZW0iLCJ1c2VPYmplY3ROYW1lU2luZ3VsYXJGcm9tUGx1cmFsIiwib2JqZWN0TWV0YWRhdGFJdGVtRmFtaWx5U2VsZWN0b3IiLCJvYmplY3RNZXRhZGF0YUl0ZW1zU3RhdGUiLCJnZXRPYmplY3RSZWNvcmRJZGVudGlmaWVyIiwiZ2VuZXJhdGVGaW5kTWFueVJlY29yZHNRdWVyeSIsIlZpZXdGaWx0ZXJPcGVyYW5kIiwicmVsYXRpb25GaWx0ZXJWYWx1ZVNjaGVtYU9iamVjdCIsImlzRGVmaW5lZCIsImZpbHRlclF1ZXJ5UGFyYW1zU2NoZW1hIiwib2JqZWN0Iiwidmlld0lkIiwic3RyaW5nIiwib3B0aW9uYWwiLCJmaWx0ZXIiLCJyZWNvcmQiLCJuYXRpdmVFbnVtIiwib3IiLCJhcnJheSIsInVzZVZpZXdGcm9tUXVlcnlQYXJhbXMiLCJhcG9sbG9DbGllbnQiLCJzZWFyY2hQYXJhbXMiLCJvYmplY3ROYW1lUGx1cmFsIiwib2JqZWN0TmFtZVNpbmd1bGFyIiwib2JqZWN0TWV0YWRhdGFJdGVtIiwib2JqZWN0TWV0YWRhdGFJdGVtcyIsInF1ZXJ5UGFyYW1zVmFsaWRhdGlvbiIsInNhZmVQYXJzZSIsInBhcnNlIiwidG9TdHJpbmciLCJmaWx0ZXJRdWVyeVBhcmFtcyIsInN1Y2Nlc3MiLCJkYXRhIiwidmlld0lkUXVlcnlQYXJhbSIsInVuZGVmaW5lZCIsImhhc0ZpbHRlcnNRdWVyeVBhcmFtcyIsIk9iamVjdCIsImVudHJpZXMiLCJsZW5ndGgiLCJnZXRGaWx0ZXJzRnJvbVF1ZXJ5UGFyYW1zIiwic25hcHNob3QiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwiZmllbGROYW1lIiwiZmlsdGVyRnJvbVVSTCIsImZpbHRlck9wZXJhbmRGcm9tVVJMIiwiZmlsdGVyVmFsdWVGcm9tVVJMIiwiZmllbGRNZXRhZGF0YUl0ZW0iLCJmaWVsZHMiLCJmaW5kIiwiZmllbGQiLCJuYW1lIiwicmVsYXRpb25PYmplY3RNZXRhZGF0YU5hbWVTaW5ndWxhciIsInJlbGF0aW9uRGVmaW5pdGlvbiIsInRhcmdldE9iamVjdE1ldGFkYXRhIiwibmFtZVNpbmd1bGFyIiwicmVsYXRpb25PYmplY3RNZXRhZGF0YU5hbWVQbHVyYWwiLCJuYW1lUGx1cmFsIiwicmVsYXRpb25PYmplY3RNZXRhZGF0YUl0ZW0iLCJnZXRMb2FkYWJsZSIsIm9iamVjdE5hbWUiLCJvYmplY3ROYW1lVHlwZSIsImdldFZhbHVlIiwic2F0aXNmaWVzUmVsYXRpb25GaWx0ZXJTY2hlbWEiLCJyZWxhdGlvblJlY29yZE5hbWVzIiwiQXJyYXkiLCJpc0FycmF5IiwicXVlcnlSZXN1bHQiLCJxdWVyeSIsInZhcmlhYmxlcyIsImlkIiwiaW4iLCJzZWxlY3RlZFJlY29yZElkcyIsInJlbGF0aW9uUmVjb3JkTmFtZXNGcm9tUXVlcnkiLCJlZGdlcyIsIm5vZGUiLCJwdXNoIiwiZmlsdGVyVmFsdWVBc1N0cmluZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJfX3R5cGVuYW1lIiwiam9pbiIsImZpZWxkTWV0YWRhdGFJZCIsIm9wZXJhbmQiLCJ2YWx1ZSIsImRpc3BsYXlWYWx1ZSIsInBlcnNpc3RBY3Rpb24iXSwibWFwcGluZ3MiOiJB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