import __vite__cjsImport0_react from "/@fs/D:/twenty-table-o/node_modules/.vite/packages/twenty-front/deps/react.js?v=226f7286"; const useCallback = __vite__cjsImport0_react["useCallback"]; const useMemo = __vite__cjsImport0_react["useMemo"];
import { useRecoilState } from "/@fs/D:/twenty-table-o/node_modules/.vite/packages/twenty-front/deps/recoil.js?v=226f7286";
import { useColumnDefinitionsFromFieldMetadata } from "/src/modules/object-metadata/hooks/useColumnDefinitionsFromFieldMetadata.ts";
import { useObjectMetadataItem } from "/src/modules/object-metadata/hooks/useObjectMetadataItem.ts";
import { isRecordBoardCompactModeActiveComponentState } from "/src/modules/object-record/record-board/states/isRecordBoardCompactModeActiveComponentState.ts";
import { recordIndexFieldDefinitionsState } from "/src/modules/object-record/record-index/states/recordIndexFieldDefinitionsState.ts";
import { useRecoilComponentStateV2 } from "/src/modules/ui/utilities/state/component-state/hooks/useRecoilComponentStateV2.ts";
import { useSaveCurrentViewFields } from "/src/modules/views/hooks/useSaveCurrentViewFields.ts";
import { useUpdateCurrentView } from "/src/modules/views/hooks/useUpdateCurrentView.ts";
import { mapBoardFieldDefinitionsToViewFields } from "/src/modules/views/utils/mapBoardFieldDefinitionsToViewFields.ts";
import { mapArrayToObject } from "/src/utils/array/mapArrayToObject.ts";
import { moveArrayItem } from "/src/utils/array/moveArrayItem.ts";
import { isDeeplyEqual } from "/src/utils/isDeeplyEqual.ts";
export const useObjectOptionsForBoard = ({ objectNameSingular, recordBoardId })=>{
    const [recordIndexFieldDefinitions, setRecordIndexFieldDefinitions] = useRecoilState(recordIndexFieldDefinitionsState);
    const { saveViewFields } = useSaveCurrentViewFields();
    const { updateCurrentView } = useUpdateCurrentView();
    const [isCompactModeActive, setIsCompactModeActive] = useRecoilComponentStateV2(isRecordBoardCompactModeActiveComponentState, recordBoardId);
    const { objectMetadataItem } = useObjectMetadataItem({
        objectNameSingular
    });
    const { columnDefinitions } = useColumnDefinitionsFromFieldMetadata(objectMetadataItem);
    const availableColumnDefinitions = useMemo(()=>columnDefinitions.filter(({ isLabelIdentifier })=>!isLabelIdentifier), [
        columnDefinitions
    ]);
    const recordIndexFieldDefinitionsByKey = useMemo(()=>mapArrayToObject(recordIndexFieldDefinitions, ({ fieldMetadataId })=>fieldMetadataId), [
        recordIndexFieldDefinitions
    ]);
    const visibleBoardFields = useMemo(()=>recordIndexFieldDefinitions.filter((boardField)=>boardField.isVisible).sort((boardFieldA, boardFieldB)=>boardFieldA.position - boardFieldB.position), [
        recordIndexFieldDefinitions
    ]);
    const hiddenBoardFields = useMemo(()=>availableColumnDefinitions.filter(({ fieldMetadataId })=>!recordIndexFieldDefinitionsByKey[fieldMetadataId]?.isVisible).map((availableColumnDefinition)=>{
            const { fieldMetadataId } = availableColumnDefinition;
            const existingBoardField = recordIndexFieldDefinitionsByKey[fieldMetadataId];
            return {
                ...existingBoardField || availableColumnDefinition,
                isVisible: false
            };
        }), [
        availableColumnDefinitions,
        recordIndexFieldDefinitionsByKey
    ]);
    const handleReorderBoardFields = useCallback((result)=>{
        if (!result.destination) {
            return;
        }
        const reorderedVisibleBoardFields = moveArrayItem(visibleBoardFields, {
            fromIndex: result.source.index - 1,
            toIndex: result.destination.index - 1
        });
        if (isDeeplyEqual(visibleBoardFields, reorderedVisibleBoardFields)) return;
        const updatedFields = [
            ...reorderedVisibleBoardFields
        ].map((field, index)=>({
                ...field,
                position: index
            }));
        setRecordIndexFieldDefinitions(updatedFields);
        saveViewFields(mapBoardFieldDefinitionsToViewFields(updatedFields));
    }, [
        saveViewFields,
        setRecordIndexFieldDefinitions,
        visibleBoardFields
    ]);
    // Todo : this seems over complex and should at least be extracted to an util with unit test.
    // Let's refactor this as we introduce the new viewBar
    const handleBoardFieldVisibilityChange = useCallback(async (updatedFieldDefinition)=>{
        const isNewViewField = !(updatedFieldDefinition.fieldMetadataId in recordIndexFieldDefinitionsByKey);
        let updatedFieldsDefinitions;
        if (isNewViewField) {
            const correspondingFieldDefinition = availableColumnDefinitions.find((availableColumnDefinition)=>availableColumnDefinition.fieldMetadataId === updatedFieldDefinition.fieldMetadataId);
            if (!correspondingFieldDefinition) return;
            const lastVisibleBoardField = visibleBoardFields[visibleBoardFields.length - 1];
            updatedFieldsDefinitions = [
                ...recordIndexFieldDefinitions,
                {
                    ...correspondingFieldDefinition,
                    position: (lastVisibleBoardField?.position || 0) + 1,
                    isVisible: true
                }
            ];
        } else {
            updatedFieldsDefinitions = recordIndexFieldDefinitions.map((existingFieldDefinition)=>existingFieldDefinition.fieldMetadataId === updatedFieldDefinition.fieldMetadataId ? {
                    ...existingFieldDefinition,
                    isVisible: !existingFieldDefinition.isVisible
                } : existingFieldDefinition);
        }
        setRecordIndexFieldDefinitions(updatedFieldsDefinitions);
        saveViewFields(mapBoardFieldDefinitionsToViewFields(updatedFieldsDefinitions));
    }, [
        recordIndexFieldDefinitionsByKey,
        setRecordIndexFieldDefinitions,
        saveViewFields,
        availableColumnDefinitions,
        visibleBoardFields,
        recordIndexFieldDefinitions
    ]);
    const setAndPersistIsCompactModeActive = useCallback((isCompactModeActive, view)=>{
        if (!view) return;
        setIsCompactModeActive(isCompactModeActive);
        updateCurrentView({
            isCompact: isCompactModeActive
        });
    }, [
        setIsCompactModeActive,
        updateCurrentView
    ]);
    return {
        handleReorderBoardFields,
        handleBoardFieldVisibilityChange,
        visibleBoardFields,
        hiddenBoardFields,
        isCompactModeActive,
        setAndPersistIsCompactModeActive
    };
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZU9iamVjdE9wdGlvbnNGb3JCb2FyZC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPbkRyYWdFbmRSZXNwb25kZXIgfSBmcm9tICdAaGVsbG8tcGFuZ2VhL2RuZCc7XG5pbXBvcnQgeyB1c2VDYWxsYmFjaywgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHVzZVJlY29pbFN0YXRlIH0gZnJvbSAncmVjb2lsJztcblxuaW1wb3J0IHsgdXNlQ29sdW1uRGVmaW5pdGlvbnNGcm9tRmllbGRNZXRhZGF0YSB9IGZyb20gJ0Avb2JqZWN0LW1ldGFkYXRhL2hvb2tzL3VzZUNvbHVtbkRlZmluaXRpb25zRnJvbUZpZWxkTWV0YWRhdGEnO1xuaW1wb3J0IHsgdXNlT2JqZWN0TWV0YWRhdGFJdGVtIH0gZnJvbSAnQC9vYmplY3QtbWV0YWRhdGEvaG9va3MvdXNlT2JqZWN0TWV0YWRhdGFJdGVtJztcbmltcG9ydCB7IGlzUmVjb3JkQm9hcmRDb21wYWN0TW9kZUFjdGl2ZUNvbXBvbmVudFN0YXRlIH0gZnJvbSAnQC9vYmplY3QtcmVjb3JkL3JlY29yZC1ib2FyZC9zdGF0ZXMvaXNSZWNvcmRCb2FyZENvbXBhY3RNb2RlQWN0aXZlQ29tcG9uZW50U3RhdGUnO1xuaW1wb3J0IHsgRmllbGRNZXRhZGF0YSB9IGZyb20gJ0Avb2JqZWN0LXJlY29yZC9yZWNvcmQtZmllbGQvdHlwZXMvRmllbGRNZXRhZGF0YSc7XG5pbXBvcnQgeyByZWNvcmRJbmRleEZpZWxkRGVmaW5pdGlvbnNTdGF0ZSB9IGZyb20gJ0Avb2JqZWN0LXJlY29yZC9yZWNvcmQtaW5kZXgvc3RhdGVzL3JlY29yZEluZGV4RmllbGREZWZpbml0aW9uc1N0YXRlJztcbmltcG9ydCB7IENvbHVtbkRlZmluaXRpb24gfSBmcm9tICdAL29iamVjdC1yZWNvcmQvcmVjb3JkLXRhYmxlL3R5cGVzL0NvbHVtbkRlZmluaXRpb24nO1xuaW1wb3J0IHsgdXNlUmVjb2lsQ29tcG9uZW50U3RhdGVWMiB9IGZyb20gJ0AvdWkvdXRpbGl0aWVzL3N0YXRlL2NvbXBvbmVudC1zdGF0ZS9ob29rcy91c2VSZWNvaWxDb21wb25lbnRTdGF0ZVYyJztcbmltcG9ydCB7IHVzZVNhdmVDdXJyZW50Vmlld0ZpZWxkcyB9IGZyb20gJ0Avdmlld3MvaG9va3MvdXNlU2F2ZUN1cnJlbnRWaWV3RmllbGRzJztcbmltcG9ydCB7IHVzZVVwZGF0ZUN1cnJlbnRWaWV3IH0gZnJvbSAnQC92aWV3cy9ob29rcy91c2VVcGRhdGVDdXJyZW50Vmlldyc7XG5pbXBvcnQgeyBHcmFwaFFMVmlldyB9IGZyb20gJ0Avdmlld3MvdHlwZXMvR3JhcGhRTFZpZXcnO1xuaW1wb3J0IHsgbWFwQm9hcmRGaWVsZERlZmluaXRpb25zVG9WaWV3RmllbGRzIH0gZnJvbSAnQC92aWV3cy91dGlscy9tYXBCb2FyZEZpZWxkRGVmaW5pdGlvbnNUb1ZpZXdGaWVsZHMnO1xuaW1wb3J0IHsgbWFwQXJyYXlUb09iamVjdCB9IGZyb20gJ34vdXRpbHMvYXJyYXkvbWFwQXJyYXlUb09iamVjdCc7XG5pbXBvcnQgeyBtb3ZlQXJyYXlJdGVtIH0gZnJvbSAnfi91dGlscy9hcnJheS9tb3ZlQXJyYXlJdGVtJztcbmltcG9ydCB7IGlzRGVlcGx5RXF1YWwgfSBmcm9tICd+L3V0aWxzL2lzRGVlcGx5RXF1YWwnO1xuXG50eXBlIHVzZU9iamVjdE9wdGlvbnNGb3JCb2FyZFBhcmFtcyA9IHtcbiAgb2JqZWN0TmFtZVNpbmd1bGFyOiBzdHJpbmc7XG4gIHJlY29yZEJvYXJkSWQ6IHN0cmluZztcbiAgdmlld0JhcklkOiBzdHJpbmc7XG59O1xuXG5leHBvcnQgY29uc3QgdXNlT2JqZWN0T3B0aW9uc0ZvckJvYXJkID0gKHtcbiAgb2JqZWN0TmFtZVNpbmd1bGFyLFxuICByZWNvcmRCb2FyZElkLFxufTogdXNlT2JqZWN0T3B0aW9uc0ZvckJvYXJkUGFyYW1zKSA9PiB7XG4gIGNvbnN0IFtyZWNvcmRJbmRleEZpZWxkRGVmaW5pdGlvbnMsIHNldFJlY29yZEluZGV4RmllbGREZWZpbml0aW9uc10gPVxuICAgIHVzZVJlY29pbFN0YXRlKHJlY29yZEluZGV4RmllbGREZWZpbml0aW9uc1N0YXRlKTtcblxuICBjb25zdCB7IHNhdmVWaWV3RmllbGRzIH0gPSB1c2VTYXZlQ3VycmVudFZpZXdGaWVsZHMoKTtcbiAgY29uc3QgeyB1cGRhdGVDdXJyZW50VmlldyB9ID0gdXNlVXBkYXRlQ3VycmVudFZpZXcoKTtcblxuICBjb25zdCBbaXNDb21wYWN0TW9kZUFjdGl2ZSwgc2V0SXNDb21wYWN0TW9kZUFjdGl2ZV0gPVxuICAgIHVzZVJlY29pbENvbXBvbmVudFN0YXRlVjIoXG4gICAgICBpc1JlY29yZEJvYXJkQ29tcGFjdE1vZGVBY3RpdmVDb21wb25lbnRTdGF0ZSxcbiAgICAgIHJlY29yZEJvYXJkSWQsXG4gICAgKTtcblxuICBjb25zdCB7IG9iamVjdE1ldGFkYXRhSXRlbSB9ID0gdXNlT2JqZWN0TWV0YWRhdGFJdGVtKHtcbiAgICBvYmplY3ROYW1lU2luZ3VsYXIsXG4gIH0pO1xuXG4gIGNvbnN0IHsgY29sdW1uRGVmaW5pdGlvbnMgfSA9XG4gICAgdXNlQ29sdW1uRGVmaW5pdGlvbnNGcm9tRmllbGRNZXRhZGF0YShvYmplY3RNZXRhZGF0YUl0ZW0pO1xuXG4gIGNvbnN0IGF2YWlsYWJsZUNvbHVtbkRlZmluaXRpb25zID0gdXNlTWVtbyhcbiAgICAoKSA9PlxuICAgICAgY29sdW1uRGVmaW5pdGlvbnMuZmlsdGVyKCh7IGlzTGFiZWxJZGVudGlmaWVyIH0pID0+ICFpc0xhYmVsSWRlbnRpZmllciksXG4gICAgW2NvbHVtbkRlZmluaXRpb25zXSxcbiAgKTtcblxuICBjb25zdCByZWNvcmRJbmRleEZpZWxkRGVmaW5pdGlvbnNCeUtleSA9IHVzZU1lbW8oXG4gICAgKCkgPT5cbiAgICAgIG1hcEFycmF5VG9PYmplY3QoXG4gICAgICAgIHJlY29yZEluZGV4RmllbGREZWZpbml0aW9ucyxcbiAgICAgICAgKHsgZmllbGRNZXRhZGF0YUlkIH0pID0+IGZpZWxkTWV0YWRhdGFJZCxcbiAgICAgICksXG4gICAgW3JlY29yZEluZGV4RmllbGREZWZpbml0aW9uc10sXG4gICk7XG5cbiAgY29uc3QgdmlzaWJsZUJvYXJkRmllbGRzID0gdXNlTWVtbyhcbiAgICAoKSA9PlxuICAgICAgcmVjb3JkSW5kZXhGaWVsZERlZmluaXRpb25zXG4gICAgICAgIC5maWx0ZXIoKGJvYXJkRmllbGQpID0+IGJvYXJkRmllbGQuaXNWaXNpYmxlKVxuICAgICAgICAuc29ydChcbiAgICAgICAgICAoYm9hcmRGaWVsZEEsIGJvYXJkRmllbGRCKSA9PlxuICAgICAgICAgICAgYm9hcmRGaWVsZEEucG9zaXRpb24gLSBib2FyZEZpZWxkQi5wb3NpdGlvbixcbiAgICAgICAgKSxcbiAgICBbcmVjb3JkSW5kZXhGaWVsZERlZmluaXRpb25zXSxcbiAgKTtcblxuICBjb25zdCBoaWRkZW5Cb2FyZEZpZWxkcyA9IHVzZU1lbW8oXG4gICAgKCkgPT5cbiAgICAgIGF2YWlsYWJsZUNvbHVtbkRlZmluaXRpb25zXG4gICAgICAgIC5maWx0ZXIoXG4gICAgICAgICAgKHsgZmllbGRNZXRhZGF0YUlkIH0pID0+XG4gICAgICAgICAgICAhcmVjb3JkSW5kZXhGaWVsZERlZmluaXRpb25zQnlLZXlbZmllbGRNZXRhZGF0YUlkXT8uaXNWaXNpYmxlLFxuICAgICAgICApXG4gICAgICAgIC5tYXAoKGF2YWlsYWJsZUNvbHVtbkRlZmluaXRpb24pID0+IHtcbiAgICAgICAgICBjb25zdCB7IGZpZWxkTWV0YWRhdGFJZCB9ID0gYXZhaWxhYmxlQ29sdW1uRGVmaW5pdGlvbjtcbiAgICAgICAgICBjb25zdCBleGlzdGluZ0JvYXJkRmllbGQgPVxuICAgICAgICAgICAgcmVjb3JkSW5kZXhGaWVsZERlZmluaXRpb25zQnlLZXlbZmllbGRNZXRhZGF0YUlkXTtcblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi4oZXhpc3RpbmdCb2FyZEZpZWxkIHx8IGF2YWlsYWJsZUNvbHVtbkRlZmluaXRpb24pLFxuICAgICAgICAgICAgaXNWaXNpYmxlOiBmYWxzZSxcbiAgICAgICAgICB9O1xuICAgICAgICB9KSxcbiAgICBbYXZhaWxhYmxlQ29sdW1uRGVmaW5pdGlvbnMsIHJlY29yZEluZGV4RmllbGREZWZpbml0aW9uc0J5S2V5XSxcbiAgKTtcblxuICBjb25zdCBoYW5kbGVSZW9yZGVyQm9hcmRGaWVsZHM6IE9uRHJhZ0VuZFJlc3BvbmRlciA9IHVzZUNhbGxiYWNrKFxuICAgIChyZXN1bHQpID0+IHtcbiAgICAgIGlmICghcmVzdWx0LmRlc3RpbmF0aW9uKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVvcmRlcmVkVmlzaWJsZUJvYXJkRmllbGRzID0gbW92ZUFycmF5SXRlbSh2aXNpYmxlQm9hcmRGaWVsZHMsIHtcbiAgICAgICAgZnJvbUluZGV4OiByZXN1bHQuc291cmNlLmluZGV4IC0gMSxcbiAgICAgICAgdG9JbmRleDogcmVzdWx0LmRlc3RpbmF0aW9uLmluZGV4IC0gMSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoaXNEZWVwbHlFcXVhbCh2aXNpYmxlQm9hcmRGaWVsZHMsIHJlb3JkZXJlZFZpc2libGVCb2FyZEZpZWxkcykpXG4gICAgICAgIHJldHVybjtcblxuICAgICAgY29uc3QgdXBkYXRlZEZpZWxkcyA9IFsuLi5yZW9yZGVyZWRWaXNpYmxlQm9hcmRGaWVsZHNdLm1hcChcbiAgICAgICAgKGZpZWxkLCBpbmRleCkgPT4gKHsgLi4uZmllbGQsIHBvc2l0aW9uOiBpbmRleCB9KSxcbiAgICAgICk7XG5cbiAgICAgIHNldFJlY29yZEluZGV4RmllbGREZWZpbml0aW9ucyh1cGRhdGVkRmllbGRzKTtcbiAgICAgIHNhdmVWaWV3RmllbGRzKG1hcEJvYXJkRmllbGREZWZpbml0aW9uc1RvVmlld0ZpZWxkcyh1cGRhdGVkRmllbGRzKSk7XG4gICAgfSxcbiAgICBbc2F2ZVZpZXdGaWVsZHMsIHNldFJlY29yZEluZGV4RmllbGREZWZpbml0aW9ucywgdmlzaWJsZUJvYXJkRmllbGRzXSxcbiAgKTtcblxuICAvLyBUb2RvIDogdGhpcyBzZWVtcyBvdmVyIGNvbXBsZXggYW5kIHNob3VsZCBhdCBsZWFzdCBiZSBleHRyYWN0ZWQgdG8gYW4gdXRpbCB3aXRoIHVuaXQgdGVzdC5cbiAgLy8gTGV0J3MgcmVmYWN0b3IgdGhpcyBhcyB3ZSBpbnRyb2R1Y2UgdGhlIG5ldyB2aWV3QmFyXG4gIGNvbnN0IGhhbmRsZUJvYXJkRmllbGRWaXNpYmlsaXR5Q2hhbmdlID0gdXNlQ2FsbGJhY2soXG4gICAgYXN5bmMgKFxuICAgICAgdXBkYXRlZEZpZWxkRGVmaW5pdGlvbjogT21pdDxcbiAgICAgICAgQ29sdW1uRGVmaW5pdGlvbjxGaWVsZE1ldGFkYXRhPixcbiAgICAgICAgJ3NpemUnIHwgJ3Bvc2l0aW9uJ1xuICAgICAgPixcbiAgICApID0+IHtcbiAgICAgIGNvbnN0IGlzTmV3Vmlld0ZpZWxkID0gIShcbiAgICAgICAgdXBkYXRlZEZpZWxkRGVmaW5pdGlvbi5maWVsZE1ldGFkYXRhSWQgaW5cbiAgICAgICAgcmVjb3JkSW5kZXhGaWVsZERlZmluaXRpb25zQnlLZXlcbiAgICAgICk7XG5cbiAgICAgIGxldCB1cGRhdGVkRmllbGRzRGVmaW5pdGlvbnM6IENvbHVtbkRlZmluaXRpb248RmllbGRNZXRhZGF0YT5bXTtcblxuICAgICAgaWYgKGlzTmV3Vmlld0ZpZWxkKSB7XG4gICAgICAgIGNvbnN0IGNvcnJlc3BvbmRpbmdGaWVsZERlZmluaXRpb24gPSBhdmFpbGFibGVDb2x1bW5EZWZpbml0aW9ucy5maW5kKFxuICAgICAgICAgIChhdmFpbGFibGVDb2x1bW5EZWZpbml0aW9uKSA9PlxuICAgICAgICAgICAgYXZhaWxhYmxlQ29sdW1uRGVmaW5pdGlvbi5maWVsZE1ldGFkYXRhSWQgPT09XG4gICAgICAgICAgICB1cGRhdGVkRmllbGREZWZpbml0aW9uLmZpZWxkTWV0YWRhdGFJZCxcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAoIWNvcnJlc3BvbmRpbmdGaWVsZERlZmluaXRpb24pIHJldHVybjtcblxuICAgICAgICBjb25zdCBsYXN0VmlzaWJsZUJvYXJkRmllbGQgPVxuICAgICAgICAgIHZpc2libGVCb2FyZEZpZWxkc1t2aXNpYmxlQm9hcmRGaWVsZHMubGVuZ3RoIC0gMV07XG5cbiAgICAgICAgdXBkYXRlZEZpZWxkc0RlZmluaXRpb25zID0gW1xuICAgICAgICAgIC4uLnJlY29yZEluZGV4RmllbGREZWZpbml0aW9ucyxcbiAgICAgICAgICB7XG4gICAgICAgICAgICAuLi5jb3JyZXNwb25kaW5nRmllbGREZWZpbml0aW9uLFxuICAgICAgICAgICAgcG9zaXRpb246IChsYXN0VmlzaWJsZUJvYXJkRmllbGQ/LnBvc2l0aW9uIHx8IDApICsgMSxcbiAgICAgICAgICAgIGlzVmlzaWJsZTogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICBdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdXBkYXRlZEZpZWxkc0RlZmluaXRpb25zID0gcmVjb3JkSW5kZXhGaWVsZERlZmluaXRpb25zLm1hcChcbiAgICAgICAgICAoZXhpc3RpbmdGaWVsZERlZmluaXRpb24pID0+XG4gICAgICAgICAgICBleGlzdGluZ0ZpZWxkRGVmaW5pdGlvbi5maWVsZE1ldGFkYXRhSWQgPT09XG4gICAgICAgICAgICB1cGRhdGVkRmllbGREZWZpbml0aW9uLmZpZWxkTWV0YWRhdGFJZFxuICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgIC4uLmV4aXN0aW5nRmllbGREZWZpbml0aW9uLFxuICAgICAgICAgICAgICAgICAgaXNWaXNpYmxlOiAhZXhpc3RpbmdGaWVsZERlZmluaXRpb24uaXNWaXNpYmxlLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgOiBleGlzdGluZ0ZpZWxkRGVmaW5pdGlvbixcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgc2V0UmVjb3JkSW5kZXhGaWVsZERlZmluaXRpb25zKHVwZGF0ZWRGaWVsZHNEZWZpbml0aW9ucyk7XG5cbiAgICAgIHNhdmVWaWV3RmllbGRzKFxuICAgICAgICBtYXBCb2FyZEZpZWxkRGVmaW5pdGlvbnNUb1ZpZXdGaWVsZHModXBkYXRlZEZpZWxkc0RlZmluaXRpb25zKSxcbiAgICAgICk7XG4gICAgfSxcbiAgICBbXG4gICAgICByZWNvcmRJbmRleEZpZWxkRGVmaW5pdGlvbnNCeUtleSxcbiAgICAgIHNldFJlY29yZEluZGV4RmllbGREZWZpbml0aW9ucyxcbiAgICAgIHNhdmVWaWV3RmllbGRzLFxuICAgICAgYXZhaWxhYmxlQ29sdW1uRGVmaW5pdGlvbnMsXG4gICAgICB2aXNpYmxlQm9hcmRGaWVsZHMsXG4gICAgICByZWNvcmRJbmRleEZpZWxkRGVmaW5pdGlvbnMsXG4gICAgXSxcbiAgKTtcblxuICBjb25zdCBzZXRBbmRQZXJzaXN0SXNDb21wYWN0TW9kZUFjdGl2ZSA9IHVzZUNhbGxiYWNrKFxuICAgIChpc0NvbXBhY3RNb2RlQWN0aXZlOiBib29sZWFuLCB2aWV3OiBHcmFwaFFMVmlldyB8IHVuZGVmaW5lZCkgPT4ge1xuICAgICAgaWYgKCF2aWV3KSByZXR1cm47XG4gICAgICBzZXRJc0NvbXBhY3RNb2RlQWN0aXZlKGlzQ29tcGFjdE1vZGVBY3RpdmUpO1xuICAgICAgdXBkYXRlQ3VycmVudFZpZXcoe1xuICAgICAgICBpc0NvbXBhY3Q6IGlzQ29tcGFjdE1vZGVBY3RpdmUsXG4gICAgICB9KTtcbiAgICB9LFxuICAgIFtzZXRJc0NvbXBhY3RNb2RlQWN0aXZlLCB1cGRhdGVDdXJyZW50Vmlld10sXG4gICk7XG5cbiAgcmV0dXJuIHtcbiAgICBoYW5kbGVSZW9yZGVyQm9hcmRGaWVsZHMsXG4gICAgaGFuZGxlQm9hcmRGaWVsZFZpc2liaWxpdHlDaGFuZ2UsXG4gICAgdmlzaWJsZUJvYXJkRmllbGRzLFxuICAgIGhpZGRlbkJvYXJkRmllbGRzLFxuICAgIGlzQ29tcGFjdE1vZGVBY3RpdmUsXG4gICAgc2V0QW5kUGVyc2lzdElzQ29tcGFjdE1vZGVBY3RpdmUsXG4gIH07XG59O1xuIl0sIm5hbWVzIjpbInVzZUNhbGxiYWNrIiwidXNlTWVtbyIsInVzZVJlY29pbFN0YXRlIiwidXNlQ29sdW1uRGVmaW5pdGlvbnNGcm9tRmllbGRNZXRhZGF0YSIsInVzZU9iamVjdE1ldGFkYXRhSXRlbSIsImlzUmVjb3JkQm9hcmRDb21wYWN0TW9kZUFjdGl2ZUNvbXBvbmVudFN0YXRlIiwicmVjb3JkSW5kZXhGaWVsZERlZmluaXRpb25zU3RhdGUiLCJ1c2VSZWNvaWxDb21wb25lbnRTdGF0ZVYyIiwidXNlU2F2ZUN1cnJlbnRWaWV3RmllbGRzIiwidXNlVXBkYXRlQ3VycmVudFZpZXciLCJtYXBCb2FyZEZpZWxkRGVmaW5pdGlvbnNUb1ZpZXdGaWVsZHMiLCJtYXBBcnJheVRvT2JqZWN0IiwibW92ZUFycmF5SXRlbSIsImlzRGVlcGx5RXF1YWwiLCJ1c2VPYmplY3RPcHRpb25zRm9yQm9hcmQiLCJvYmplY3ROYW1lU2luZ3VsYXIiLCJyZWNvcmRCb2FyZElkIiwicmVjb3JkSW5kZXhGaWVsZERlZmluaXRpb25zIiwic2V0UmVjb3JkSW5kZXhGaWVsZERlZmluaXRpb25zIiwic2F2ZVZpZXdGaWVsZHMiLCJ1cGRhdGVDdXJyZW50VmlldyIsImlzQ29tcGFjdE1vZGVBY3RpdmUiLCJzZXRJc0NvbXBhY3RNb2RlQWN0aXZlIiwib2JqZWN0TWV0YWRhdGFJdGVtIiwiY29sdW1uRGVmaW5pdGlvbnMiLCJhdmFpbGFibGVDb2x1bW5EZWZpbml0aW9ucyIsImZpbHRlciIsImlzTGFiZWxJZGVudGlmaWVyIiwicmVjb3JkSW5kZXhGaWVsZERlZmluaXRpb25zQnlLZXkiLCJmaWVsZE1ldGFkYXRhSWQiLCJ2aXNpYmxlQm9hcmRGaWVsZHMiLCJib2FyZEZpZWxkIiwiaXNWaXNpYmxlIiwic29ydCIsImJvYXJkRmllbGRBIiwiYm9hcmRGaWVsZEIiLCJwb3NpdGlvbiIsImhpZGRlbkJvYXJkRmllbGRzIiwibWFwIiwiYXZhaWxhYmxlQ29sdW1uRGVmaW5pdGlvbiIsImV4aXN0aW5nQm9hcmRGaWVsZCIsImhhbmRsZVJlb3JkZXJCb2FyZEZpZWxkcyIsInJlc3VsdCIsImRlc3RpbmF0aW9uIiwicmVvcmRlcmVkVmlzaWJsZUJvYXJkRmllbGRzIiwiZnJvbUluZGV4Iiwic291cmNlIiwiaW5kZXgiLCJ0b0luZGV4IiwidXBkYXRlZEZpZWxkcyIsImZpZWxkIiwiaGFuZGxlQm9hcmRGaWVsZFZpc2liaWxpdHlDaGFuZ2UiLCJ1cGRhdGVkRmllbGREZWZpbml0aW9uIiwiaXNOZXdWaWV3RmllbGQiLCJ1cGRhdGVkRmllbGRzRGVmaW5pdGlvbnMiLCJjb3JyZXNwb25kaW5nRmllbGREZWZpbml0aW9uIiwiZmluZCIsImxhc3RWaXNpYmxlQm9hcmRGaWVsZCIsImxlbmd0aCIsImV4aXN0aW5nRmllbGREZWZpbml0aW9uIiwic2V0QW5kUGVyc2lzdElzQ29tcGFjdE1vZGVBY3RpdmUiLCJ2aWV3IiwiaXNDb21wYWN0Il0sIm1hcHBpbmdzIjoiQUFDQSxTQUFTQSxXQUFXLEVBQUVDLE9BQU8sUUFBUSxRQUFRO0FBQzdDLFNBQVNDLGNBQWMsUUFBUSxTQUFTO0FBRXhDLFNBQVNDLHFDQUFxQyxRQUFRLGdFQUFnRTtBQUN0SCxTQUFTQyxxQkFBcUIsUUFBUSxnREFBZ0Q7QUFDdEYsU0FBU0MsNENBQTRDLFFBQVEsbUZBQW1GO0FBRWhKLFNBQVNDLGdDQUFnQyxRQUFRLHVFQUF1RTtBQUV4SCxTQUFTQyx5QkFBeUIsUUFBUSx1RUFBdUU7QUFDakgsU0FBU0Msd0JBQXdCLFFBQVEseUNBQXlDO0FBQ2xGLFNBQVNDLG9CQUFvQixRQUFRLHFDQUFxQztBQUUxRSxTQUFTQyxvQ0FBb0MsUUFBUSxxREFBcUQ7QUFDMUcsU0FBU0MsZ0JBQWdCLFFBQVEsaUNBQWlDO0FBQ2xFLFNBQVNDLGFBQWEsUUFBUSw4QkFBOEI7QUFDNUQsU0FBU0MsYUFBYSxRQUFRLHdCQUF3QjtBQVF0RCxPQUFPLE1BQU1DLDJCQUEyQixDQUFDLEVBQ3ZDQyxrQkFBa0IsRUFDbEJDLGFBQWEsRUFDa0I7SUFDL0IsTUFBTSxDQUFDQyw2QkFBNkJD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